// jwav by qizhang2@iflytek.com
(function($){"use strict";var self;var options={trans:130,waitTrans:60,waitInterval:70,pointRadius:4,pointInterval:5,pointColor:'red',waitLong:25,waitShort:10,waitType:'diffuse',};var volume={0:[1,1,1,1,1,1,1,1,1,1],1:[2.0,1.5,2.0,1.5,2.0,2.0,1.7,1.5,2.0,3.0],2:[2.0,3.0,2.0,2.5,3.0,2.5,2.0,2.5,3.0,4.0],3:[2.5,3.5,2.0,3.5,3.5,2.5,3.0,4.0,3.5,4.5],4:[4.0,3.0,5.0,4.0,3.5,2.5,3.5,4.5,5.5,4.5],5:[5.0,4.0,5.0,4.0,5.5,6.0,5.0,4.0,5.0,5.5],6:[6.0,5.0,4.0,5.0,6.0,7.0,6.5,5.5,4.5,3.5],};var pointNum;var halfHeight;var pointList=[];var pointReflect=[];var controlPoint;var scaleFun;$.fn.wav=function(_options,_volume){if(!this){console.error('no selected emelent');return}self=this;options=$.extend({},options,_options);(function(){pointNum=volume[0].length;if(!pointNum){console.error('volume is error');return}var blockHeight=self.height();halfHeight=blockHeight/2;var pointRadius=options.pointRadius;var pointInterval=options.pointInterval;var pointColor=options.pointColor;var wrapWidh=(pointInterval+pointRadius)*2*pointNum*2;var top=$('<div>').css({height:halfHeight,margin:'auto',width:wrapWidh,});var marginTop=halfHeight-pointRadius;var point=$('<div>').css({margin:marginTop+'px '+pointInterval+'px 0',float:'left',width:2*pointRadius+'px',height:pointRadius+'px',background:pointColor,'border-radius':pointRadius+'px '+pointRadius+'px 0 0','transition-timing-function':'ease-out'});for(var j=0;j<2;j++)for(var i=0;i<pointNum;i++){var thePoint=point.clone();pointList.push(thePoint);top.append(thePoint)}var buttom=top.clone();buttom.children().each(function(){pointReflect.push($(this));var margin=$(this).css('marginTop');$(this).css({marginTop:0,marginButtom:margin,'border-radius':'0 0 '+pointRadius+'px '+pointRadius+'px'})});self.append(top);self.append(buttom);if(options.waitType=='concentrate'){controlPoint=pointNum+1;scaleFun=scale}else if(options.waitType=='linear'){controlPoint=2*pointNum+1;scaleFun=scaleLeftOnly}else{controlPoint=pointNum+1;scaleFun=function(index,height,trans){scale(pointNum-index,height,trans)}}})();return{waveChange:change,waitStart:wait,waitStop:stop,}};var change=function(value,trans){var list=volume[value];if(!list){console.error('error volume value');return}for(var i=0;i<pointNum;i++){var rate=list[i];var height=Math.round(options.pointRadius*rate);scale(i,height,trans)}};var isStop=true;var wait=function(){if(isStop==false)return;reset(0);window.waitToggle=waitToggle;isStop=false;waitLoop()};var reset=function(duration){change(0,duration)};var stop=function(){isStop=true};var waitLoop=function(delay){var interval=options.waitInterval;var index;for(var i=0;i<=pointNum*2+1;i++){var delayTime=delay+interval*i;setTimeout('waitToggle('+i+','+options.pointRadius+','+options.waitTrans+')',delayTime)}};var waitToggle=function(i,height,trans){var index;if(!isStop){index=i-2;scaleFun(index,options.pointRadius,trans);index=i-1;scaleFun(index,options.waitShort,trans);index=i;scaleFun(index,options.waitLong,trans);index=i+1;scaleFun(index,options.waitShort,trans);if(index==(pointNum*2+1)){waitLoop(options.waitInterval)}}else{reset(trans)}};var scale=function(index,height,trans){if(index<0||index>=pointNum)return;scaleLeftOnly(index,height,trans);scaleReflectRight(index,height,trans)};var scaleReflectRight=function(index,height,trans){if(index<0||index>=pointNum*2)return;var cssObj=calcuteScaleCss(index,height,trans);var reflectIndex=pointNum*2-1-index;pointList[reflectIndex].css(cssObj);var reflectCss=getReflactCss(cssObj);pointReflect[reflectIndex].css(reflectCss)};var scaleLeftOnly=function(index,height,trans){if(index<0||index>=pointNum*2)return;var cssObj=calcuteScaleCss(index,height,trans);pointList[index].css(cssObj);var reflectCss=getReflactCss(cssObj);pointReflect[index].css(reflectCss)};var calcuteScaleCss=function(index,height,trans){var point=pointList[index];var marginTop=halfHeight-height;var transition=trans;if(trans===undefined){var transition=options.trans}transition+='ms';return{height:height,marginTop:marginTop,'transition-duration':transition}};var getReflactCss=function(css){css.marginButtom=css.marginTop;delete css.marginTop;return css}})($);